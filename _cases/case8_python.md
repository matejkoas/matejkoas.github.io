---
layout: case
title: "–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å: –ü—Ä–æ–¥–∞–∂–∏ –≤ —Å–µ—Ç–∏ —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–æ–≤"
date: 2023-05-11
categories: [SQL, Analytics, Retail]
description: >
  –ê–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö Corporaci√≥n Favorita ‚Äî –∫—Ä—É–ø–Ω–æ–π —Ä–æ–∑–Ω–∏—á–Ω–æ–π —Å–µ—Ç–∏ –≤ –≠–∫–≤–∞–¥–æ—Ä–µ. –†–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä—è–¥–∞–º–∏, –ø—Ä–æ–º–æ-–∞–∫—Ü–∏—è–º–∏, –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏ –∏ –º–∞–∫—Ä–æ—Ñ–∞–∫—Ç–æ—Ä–∞–º–∏.
---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–¶–µ–ª—å –∫–µ–π—Å–∞ ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö —Å–µ—Ç–∏ *Corporaci√≥n Favorita* –∏ –≤—ã—è–≤–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –æ–±—ä–µ–º –ø—Ä–æ–¥–∞–∂. –í —Ñ–æ–∫—É—Å–µ ‚Äî –≤–ª–∏—è–Ω–∏–µ –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π, –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤, —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å, —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç:
- –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏,
- —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω—ã –∏ —Ç–æ–≤–∞—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏,
- –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π (–ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤, –ß–°, –≤—ã–ø–ª–∞—Ç –∑–∞—Ä–ø–ª–∞—Ç),
- —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≥–∏–ø–æ—Ç–µ–∑—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∏ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π.

## –î–∞—Ç–∞—Å–µ—Ç—ã

- **train.csv** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂ –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤.
- **test.csv** ‚Äî –∞–Ω–∞–ª–æ–≥ train, –Ω–æ –±–µ–∑ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `sales`.
- **stores.csv** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º –º–∞–≥–∞–∑–∏–Ω–µ.
- **oil.csv** ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ –Ω–µ—Ñ—Ç—å.
- **holidays_events.csv** ‚Äî –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –∏ –æ—Å–æ–±—ã—Ö –¥–Ω–µ–π.

---

## üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

–ù–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ –º—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π:

```python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score, StratifiedKFold
from sklearn.impute import SimpleImputer
from sklearn.ensemble import RandomForestRegressor
from sklearn.preprocessing import OneHotEncoder, LabelEncoder, StandardScaler
import tensorflow as tf
import warnings
warnings.filterwarnings("ignore")
```
<br>

## üìä –ò–º–ø–æ—Ä—Ç –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ:

```python
  train = pd.read_csv('data/train.csv')
  test = pd.read_csv('data/test.csv')
  stores = pd.read_csv('data/stores.csv')
  oil = pd.read_csv('data/oil.csv')
  holidays = pd.read_csv('data/holidays_events.csv')
```
<br>
–û–±—ä–µ–¥–∏–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```python
  def merge_df(df):
      df = pd.merge(df, oil, how='left', on='date')
      df = pd.merge(df, stores, how='left', on='store_nbr')
      df = pd.merge(df, holidays, how='left', on='date')
      return df

  train_merge = merge_df(train)
  test_merge = merge_df(test)
```
## üßπ –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—ã.
- –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ–º –ø—Ä–æ–ø—É—Å–∫–∏ –≤ —Ü–µ–Ω–∞—Ö –Ω–∞ –Ω–µ—Ñ—Ç—å.
- –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∫–æ–ª–æ–Ω–∫–∏.

```python
  train_merge['date'] = pd.to_datetime(train_merge['date'])
train_merge['dcoilwtico'] = train_merge['dcoilwtico'].interpolate().fillna(93)
train_merge.rename(columns={'type_x': 'type_shop', 'type_y': 'type_hol'}, inplace=True)

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø—Ä–æ–ø—É—Å–∫–æ–≤
for col in ['type_hol', 'locale', 'locale_name', 'description', 'transferred']:
    train_merge[col] = train_merge[col].fillna('-')
```
<br>
## üîç –ü–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑
<br>
```python
  train_merge.describe().round(3)
```
   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_1.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid">
    </div>
<br>

## üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º
<br>
–¢–∞–∫ –∫–∞–∫ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–∏, –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—ã—à–µ –¥–∞—ë—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ. –û–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Äî cluster. –ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –ø—Ä–æ–¥–∞–∂–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º:
<br>

```python
    clusters = train_merge.groupby(['cluster']).agg({
      'sales': 'sum',
      'onpromotion': 'sum'
})
```
```python
# –°—Ç—Ä–æ–∏–º —Å—Ç–æ–ª–±—á–∞—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º
clusters.plot(kind='bar', y='sales', color = 'skyblue', figsize=(10, 6))

plt.title('Total Sales by Cluster')
plt.xlabel('Cluster')
plt.ylabel('Total Sales')

plt.show()
```

   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_2.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>
<br>

‚û° –ü—Ä–æ–¥–∞–∂–∏ —Å–∏–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏. –≠—Ç–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç –∑–Ω–∞—á–∏–º–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∞ cluster –¥–ª—è –º–æ–¥–µ–ª–∏.
<br>
–¢–µ–ø–µ—Ä—å –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–æ–¥–≤–∏–≥–∞–µ–º—ã–µ —Ç–æ–≤–∞—Ä—ã (onpromotion):

```python
  clusters.plot(kind='bar', y='onpromotion', color='orange', figsize=(10, 6))
  plt.title('Total Onpromotion by Cluster')
  plt.xlabel('Cluster')
  plt.ylabel('Onpromotion')
  plt.show()
```

   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_3.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>
<br>
‚û° –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–æ-—Ç–æ–≤–∞—Ä–æ–≤ —Ç–∞–∫–∂–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏.
<br>
–ü—Ä–æ–≤–µ—Ä–∏–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:

```python
def num_col(df):
    return df.select_dtypes(include=['int64', 'float64'])

train_merge_num = num_col(train_merge)
corr_matrix = train_merge_num.corr()
```
<br>
–°—Ç—Ä–æ–∏–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É:

```python
plt.figure(figsize=(10, 8))
sns.heatmap(corr_matrix, annot=True, cmap='coolwarm', fmt=".2f")
plt.title('Correlation Heatmap')
plt.show()
```
   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_4.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-50">
    </div>
<br>
üìå –í—ã–≤–æ–¥—ã –∏–∑ —Ç–µ–ø–ª–æ–∫–∞—Ä—Ç—ã:
<br>
- id –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ —Å–∏–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å dcoilwtico, –Ω–æ —ç—Ç–æ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å. –í –º–æ–¥–µ–ª–∏ id —É—á–∏—Ç—ã–≤–∞—Ç—å –Ω–µ –±—É–¥–µ–º.
- –ú–µ–∂–¥—É onpromotion –∏ sales –µ—Å—Ç—å —É–º–µ—Ä–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (0.43), —á—Ç–æ –ª–æ–≥–∏—á–Ω–æ ‚Äî –∞–∫—Ü–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏.
- –°–∏–ª—å–Ω—ã—Ö –ª–∏–Ω–µ–π–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –¥—Ä—É–≥–∏–º–∏ —á–∏—Å–ª–æ–≤—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –Ω–µ—Ç ‚Äî –¥–∞–Ω–Ω—ã–µ –≤—ã–≥–ª—è–¥—è—Ç —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.

## üõ¢ –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –º–µ–Ω—è–ª–∏—Å—å —Ü–µ–Ω—ã –Ω–∞ –Ω–µ—Ñ—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–∏:
<br>

```python
sns.set(style="whitegrid")
plt.figure(figsize=(12, 6))
sns.lineplot(x='date', y='dcoilwtico', data=train_merge)
plt.xlabel('Date')
plt.ylabel('Oil Price')
plt.title('Oil Prices')
plt.xticks(rotation=45)
plt.show()
```
<br>

   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_5.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>
<br>
üìå –í–∏–∑—É–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å 4 —Ü–µ–Ω–æ–≤—ã–µ –∑–æ–Ω—ã:
<br>
- –ó–æ–Ω–∞ 0: —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫ (2013 ‚Äì —Å–µ—Ä–µ–¥–∏–Ω–∞ 2014), —Ü–µ–Ω–∞ –≤—ã—à–µ $85
- –ó–æ–Ω–∞ 1: –ø–∞–¥–µ–Ω–∏–µ –¥–æ $65‚Äì85 (–≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ 2014)
- –ó–æ–Ω–∞ 2: –∫–æ—Ä–∏–¥–æ—Ä $40‚Äì65 ‚Äî —Å–Ω–æ–≤–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- –ó–æ–Ω–∞ 3: —Å–∏–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ ‚Äî —Ü–µ–Ω–∞ –Ω–∏–∂–µ $40
<br>

–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞–∂–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–æ–º –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥–∞–∂ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–µ–∑–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö. –ü–æ—ç—Ç–æ–º—É —Å–æ–∑–¥–∞–¥–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏.
<br>
## üß© –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å
<br>
–î–æ–±–∞–≤–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ oil_zone –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ–ª—å—Ç—ã –∑–∞ 1 –Ω–µ–¥–µ–ª—é, 1 –º–µ—Å—è—Ü –∏ 3 –º–µ—Å—è—Ü–∞:

```python
def oil_features(df):
    df_copy = df.copy()
    df_copy['index'] = range(len(df))
    
    # –¶–µ–Ω–æ–≤—ã–µ –∑–æ–Ω—ã
    df_copy['oil_zone'] = df_copy['dcoilwtico'].apply(
        lambda x: 0 if x > 85 else (1 if x > 65 else (2 if x > 40 else 3))
    )
    
    temp_df = df_copy.set_index('index')
    
    # –†–∞—Å—á—ë—Ç –¥–µ–ª—å—Ç
    temp_df['oil_price_week_ago'] = temp_df['dcoilwtico'].shift(7)
    temp_df['delta_oil_week'] = temp_df['dcoilwtico'] - temp_df['oil_price_week_ago']
    
    temp_df['oil_price_month_ago'] = temp_df['dcoilwtico'].shift(30)
    temp_df['delta_oil_month'] = temp_df['dcoilwtico'] - temp_df['oil_price_month_ago']
    
    temp_df['oil_price_3month_ago'] = temp_df['dcoilwtico'].shift(90)
    temp_df['delta_oil_3mon'] = temp_df['dcoilwtico'] - temp_df['oil_price_3month_ago']
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –∏—Å—Ö–æ–¥–Ω—ã–º –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–æ–º
    df_copy_merged = pd.merge(df_copy, temp_df[['delta_oil_week', 'delta_oil_month', 'delta_oil_3mon']],
                              how='left', on='index')
    
    df_copy_merged.drop(columns=['index'], inplace=True)
    
    return df_copy_merged

# –ü—Ä–∏–º–µ–Ω–∏–º –∫ train –∏ test
train_merge = oil_features(train_merge)
test_merge = oil_features(test_merge)
```
<br>
–ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–æ–ø—É—Å–∫–∏:

```python
train_merge.isna().sum()
```
   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_6.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-25">
    </div>

‚û° –ü—Ä–æ–ø—É—Å–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –Ω–æ–≤—ã—Ö –¥–µ–ª—å—Ç–∞—Ö ‚Äî –æ–Ω–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –Ω–∞—á–∞–ª–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞. –ó–∞–ø–æ–ª–Ω–∏–º –∏—Ö –Ω—É–ª—è–º–∏:

```python
def fillna_delta_oil(df):
    df['delta_oil_week'] = df['delta_oil_week'].fillna(0)
    df['delta_oil_month'] = df['delta_oil_month'].fillna(0)
    df['delta_oil_3mon'] = df['delta_oil_3mon'].fillna(0)
    return df

train_merge = fillna_delta_oil(train_merge)
test_merge = fillna_delta_oil(test_merge)
```
–ü—Ä–æ–≤–µ—Ä–∏–º –µ—â—ë —Ä–∞–∑:

```python
train_merge.isna().sum()
```

   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_7.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-25">
    </div>

‚úÖ –ü—Ä–æ–ø—É—Å–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã. –ù–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –º–æ–¥–µ–ª–∏.

## üìà –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ–¥–∞–∂ –ø–æ –º–µ—Å—è—Ü–∞–º
<br>
–î–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É month –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ date, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–≤ –¥–∞—Ç—É –∫ –ø–µ—Ä–∏–æ–¥—É "–≥–æ–¥-–º–µ—Å—è—Ü":

```python
train_merge['month'] = train_merge['date'].dt.to_period('M')
```
–¢–µ–ø–µ—Ä—å —Å–≥—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –º–µ—Å—è—Ü–∞–º –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º:
<br>
- —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂ (sales);
- —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –Ω–∞ –Ω–µ—Ñ—Ç—å –∑–∞ –º–µ—Å—è—Ü (dcoilwtico):

```python
sales_month = train_merge.groupby(['month']).agg({
    'sales': 'sum',
    'dcoilwtico': 'mean'
})
```

–ü–æ—Å–ª–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å—Ç–æ–ª–±–µ—Ü month –Ω–∞–º –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, —É–¥–∞–ª—è–µ–º –µ–≥–æ:

```python
train_merge.drop(['month'], axis=1, inplace=True)
```

<br>
–î–æ–±–∞–≤–∏–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü year (–≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏), —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è:

```python
sales_month['year'] = sales_month.index.astype(str)
```
<br>

üìä –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ–¥–∞–∂:

```python
plt.figure(figsize=(12, 6))
sns.lineplot(x='year', y='sales', data=sales_month)

plt.xlabel('Date')
plt.ylabel('Sales')
plt.title('Sales by Month')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
```
   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_8.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>
<br>

üßê –í—ã–≤–æ–¥—ã –ø–æ –≥—Ä–∞—Ñ–∏–∫—É:
- –û–±—â–∏–π —Ç—Ä–µ–Ω–¥: –ø—Ä–æ–¥–∞–∂–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞—Å—Ç—É—Ç ‚Äî —Ä–æ–∑–Ω–∏—á–Ω–∞—è —Å–µ—Ç—å —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è.
- –°–∫–∞—á–∫–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑: –∑–∞–º–µ—Ç–Ω—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –æ–±—ä—ë–º–∞ –ø—Ä–æ–¥–∞–∂ (~0.5 –º–ª–Ω), —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ –≤–ª–∏—è–Ω–∏–∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤.
- –î–µ–∫–∞–±—Ä—å 2014: —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∏–ª–∏ –∫—Ä–∏–∑–∏—Å–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏.
- –Ø–Ω–≤–∞—Ä—å‚Äì–∞–ø—Ä–µ–ª—å 2015: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–±–∏–≤–∞–µ—Ç—Å—è –∏–∑ –æ–±—â–µ–π –¥–∏–Ω–∞–º–∏–∫–∏ ‚Äî —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏.
- –ê–≤–≥—É—Å—Ç 2017: —Ä–µ–∑–∫–∏–π –ø—Ä–æ–≤–∞–ª –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –¥–æ –Ω—É–ª—è, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≤—ã–∑–≤–∞–Ω —Ç–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –∏ –æ–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é.

## üìä –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ –æ—Ç —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å
<br>
–î–ª—è –æ—Ü–µ–Ω–∫–∏ –≤–ª–∏—è–Ω–∏—è –Ω–µ—Ñ—Ç—è–Ω—ã—Ö —Ü–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ —Å–æ–µ–¥–∏–Ω–∏–º –æ–±–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –æ–¥–Ω–æ–º –≥—Ä–∞—Ñ–∏–∫–µ.

```python
# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–∏ X
sales_month['year_month'] = sales_month.index.astype(str)

# –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ —Å –¥–≤—É–º—è –æ—Å—è–º–∏ Y
fig, ax1 = plt.subplots(figsize=(12, 6))

# –ü–µ—Ä–≤–∞—è –æ—Å—å Y ‚Äî –ø—Ä–æ–¥–∞–∂–∏
color = 'tab:blue'
ax1.set_xlabel('Date')
ax1.set_ylabel('Sales', color=color)
ax1.plot(sales_month['year_month'], sales_month['sales'], color=color)
ax1.tick_params(axis='y', labelcolor=color)

# –í—Ç–æ—Ä–∞—è –æ—Å—å Y ‚Äî —Ü–µ–Ω—ã –Ω–∞ –Ω–µ—Ñ—Ç—å
ax2 = ax1.twinx()
color = 'tab:red'
ax2.set_ylabel('Oil Price', color=color)
ax2.plot(sales_month['year_month'], sales_month['dcoilwtico'], color=color)
ax2.tick_params(axis='y', labelcolor=color)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
plt.title('Sales and Oil Price over Time')
ax1.set_xticks(sales_month['year_month'][::5])
ax1.set_xticklabels(sales_month['year_month'][::5], rotation=45)

plt.tight_layout()
plt.show()
```
   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_9.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>
<br>

üßê –í—ã–≤–æ–¥—ã:
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: –≤ —Ü–µ–ª–æ–º ‚Äî —á–µ–º –Ω–∏–∂–µ —Ü–µ–Ω–∞ –Ω–∞ –Ω–µ—Ñ—Ç—å, —Ç–µ–º –≤—ã—à–µ –ø—Ä–æ–¥–∞–∂–∏. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî –¥–µ–∫–∞–±—Ä—å 2014.
- –ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏: —Ä—ã–Ω–æ–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–µ—Ñ—Ç—å —Å –ª–∞–≥–æ–º ~2-3 –º–µ—Å—è—Ü–∞.
- –§–∏—á–∏ delta_oil_3mon –æ—Å–æ–±–µ–Ω–Ω–æ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–∞ ‚Äî –ø–æ–∑–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–º –µ—ë –∑–Ω–∞—á–∏–º–æ—Å—Ç—å.
<br>
üìâ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–æ–º–∞–ª–∏–∏ –∞–≤–≥—É—Å—Ç–∞ 2017
<br>
–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º:

```python
train_merge[train_merge['date'] > '2017-07-30'].shape[0]     # –∞–≤–≥—É—Å—Ç
train_merge[(train_merge['date'] > '2017-06-30') & (train_merge['date'] < '2017-08-01')].shape[0]  # –∏—é–ª—å
train_merge[(train_merge['date'] > '2017-05-31') & (train_merge['date'] < '2017-07-01')].shape[0]  # –∏—é–Ω—å
train_merge[(train_merge['date'] > '2017-04-30') & (train_merge['date'] < '2017-06-01')].shape[0]  # –º–∞–π
```
<br>
üëâ –í –∞–≤–≥—É—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—á—Ç–∏ –≤–¥–≤–æ–µ –º–µ–Ω—å—à–µ, –Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Ö, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –µ—Å—Ç—å –ª–∏ –ø—Ä–æ–≤–∞–ª—ã:

```python
sales_2017_summer = train_merge[train_merge['date'] > '2017-05-30']
plt.figure(figsize=(12, 6))
sns.lineplot(x='date', y='sales', data=sales_2017_summer)
plt.xlabel('Date')
plt.ylabel('Sales')
plt.title('Sales in Summer 2017')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
```
   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_10.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>

<br>
üìå –í—ã–≤–æ–¥: –≥—Ä–∞—Ñ–∏–∫ –∑–∞ –ª–µ—Ç–æ 2017 –≥–æ–¥–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å ‚Äî —Å–µ—Ä–µ–¥–∏–Ω–∞ –∞–≤–≥—É—Å—Ç–∞. –ó–Ω–∞—á–∏—Ç, –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç–æ –æ–±—Ä–µ–∑–∞–Ω—ã, –Ω–æ –Ω–µ –∏—Å–∫–∞–∂–µ–Ω—ã.
<br>

## üéâ –í–ª–∏—è–Ω–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Å–æ–±—ã—Ç–∏–π –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
<br>

**‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏—á–µ–π –ø–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º**
<br>
–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ –º–æ–≥—É—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π. –°–æ–∑–¥–∞—ë–º —Ñ–∏—á–∏:

- hol_day ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å (—Å —É—á—ë—Ç–æ–º —Ç–∏–ø–∞, —Ä–µ–≥–∏–æ–Ω–∞ –∏ –ø–µ—Ä–µ–Ω–æ—Å–∞)
- len_hol ‚Äî –¥–ª–∏–Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É)
- hol_tomorrow ‚Äî –ø—Ä–∏–∑–Ω–∞–∫, –µ—Å—Ç—å –ª–∏ –ø—Ä–∞–∑–¥–Ω–∏–∫ –∑–∞–≤—Ç—Ä–∞

```python
def hol_day_define(df):
    df['hol_day'] = 0
    df.loc[(df['locale'] == 'Local') & (df['locale_name'] == df['city']), 'hol_day'] = 1
    df.loc[(df['locale'] == 'Regional') & (df['locale_name'] == df['state']), 'hol_day'] = 1
    df.loc[df['locale'] == 'National', 'hol_day'] = 1
    df.loc[df['type_hol'] == 'Work Day', 'hol_day'] = 0
    df.loc[df['transferred'] == True, 'hol_day'] = 0
    return df

train_merge = hol_day_define(train_merge)
test_merge = hol_day_define(test_merge)
```
<br>
**üí∞ –£—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç–Ω—ã—Ö –¥–Ω–µ–π**
<br>
–ü–æ–∫—É–ø–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞—Ç—å 15-–≥–æ —á–∏—Å–ª–∞ –∏ –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞. –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏—á—É salary:
<br>

```python
def salary_days(df):
    df['salary'] = 0
    df['day'] = df['date'].dt.day
    df['month_end'] = df['date'].dt.is_month_end
    df.loc[(df['day'] == 15) | (df['month_end']), 'salary'] = 1
    df.drop(['day', 'month_end'], axis=1, inplace=True)
    return df

train_merge = salary_days(train_merge)
test_merge = salary_days(test_merge)
```

**üåç –í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è 16 –∞–ø—Ä–µ–ª—è 2016**
<br>
–ü–æ—Å–ª–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ–¥–∞–∂ ‚Äî —ç—Ç–æ –º–æ–∂–Ω–æ —É—á–µ—Å—Ç—å –∫–∞–∫ —Ñ–∏—á—É earthquake:

```python
def earthquake_feature(df):
    df['earthquake'] = 0
    df.loc[(df['date'] > '2016-04-16') & (df['date'] < '2016-04-24'), 'earthquake'] = 2
    df.loc[(df['date'] > '2016-04-24') & (df['date'] < '2016-05-15'), 'earthquake'] = 1
    return df

train_merge = earthquake_feature(train_merge)
test_merge = earthquake_feature(test_merge)
```
<br>
üß† –í—ã–≤–æ–¥: –≤–ª–∏—è–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤, –∑–∞—Ä–ø–ª–∞—Ç, –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ) —Ö–æ—Ä–æ—à–æ –ª–æ–∂–∏—Ç—Å—è –≤ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫—É—é –º–æ–¥–µ–ª—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è. –≠—Ç–∏ —Ñ–∏—á–∏ –º–æ–≥—É—Ç –¥–∞—Ç—å –±—É—Å—Ç –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏.
<br>

## ü§ñ –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ—Ç–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
<br>

**üßπ –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞**

–ò–∑–±–∞–≤–∏–ª–∏—Å—å –æ—Ç –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã—Ö –¥–ª—è –º–æ–¥–µ–ª–∏ –∫–æ–ª–æ–Ω–æ–∫: date, description, transferred, locale_name.

```python
def drop_columns(df):
    columns_to_drop = ['date', 'description', 'transferred', 'locale_name']
    df_copy = df.copy()
    df_copy.drop(columns=columns_to_drop, axis=1, inplace=True)
    return df_copy
```

<br>

**üîÑ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**

- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ LabelEncoder
- –ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ StandardScaler

```python
def transform_features(df):
    le_col = ['locale', 'type_shop', 'type_hol', 'family', 'city', 'state']
    sc_col = ['store_nbr', 'onpromotion', 'dcoilwtico', 'cluster', 'oil_zone',
              'delta_oil_week', 'delta_oil_month', 'delta_oil_3mon', 'hol_day', 'salary']

    le = LabelEncoder()
    for col in le_col:
        df[col] = le.fit_transform(df[col])

    sc = StandardScaler()
    df[sc_col] = sc.fit_transform(df[sc_col])
    
    return df
```

<br>

**üåü –û—Ü–µ–Ω–∫–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**
<br>
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω RandomForestRegressor –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏—á–µ–π:

```python
X = train_transformed.drop(columns=['id', 'sales'])
y = train_transformed['sales']

model = RandomForestRegressor(n_estimators=10, random_state=42)
model.fit(X, y)

feature_importance_df = pd.DataFrame({
    'Feature': X.columns,
    'Importance': model.feature_importances_
}).sort_values(by='Importance', ascending=False)
```

   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_11.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>

<br>

**üìà –í—ã–≤–æ–¥—ã –ø–æ –¥–∏–∞–≥—Ä–∞–º–º–µ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:**

- –¶–µ–Ω–∞ –Ω–∞ –Ω–µ—Ñ—Ç—å (dcoilwtico) ‚Äî –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤. –ï—ë –≤–ª–∏—è–Ω–∏–µ –≤—ã—à–µ, —á–µ–º —É –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω—ã (–¥–µ–ª—å—Ç), —á—Ç–æ –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ –±–æ–ª–µ–µ —Å–∏–ª—å–Ω–æ–π —Å–≤—è–∑–∏ —Å —É—Ä–æ–≤–Ω–µ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è.
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –Ω–∞ –Ω–µ—Ñ—Ç—å (delta_oil_week, delta_oil_month, delta_oil_3mon) ‚Äî –∏–º–µ—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤–ª–∏—è–Ω–∏–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–µ—Ä–∏–æ–¥–∞, —á—Ç–æ –Ω–µ–º–Ω–æ–≥–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ.
- –ü—Ä–∏–∑–Ω–∞–∫ oil_zone –æ–∫–∞–∑–∞–ª—Å—è –Ω–∞–∏–º–µ–Ω–µ–µ –∑–Ω–∞—á–∏–º—ã–º, –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏.
- –°–æ–±—ã—Ç–∏–π–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã ‚Äî earthquake, hol_day, salary ‚Äî –≤ —Å—É–º–º–µ –¥–∞–ª–∏ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –≤–∫–ª–∞–¥ –≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∏ –≤–ª–∏—è—é—Ç —Ç–æ—á–µ—á–Ω–æ –∏ —Å–ª–∞–±–æ –≤—ã—Ä–∞–∂–µ–Ω—ã –≤ –æ–±—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω–µ –ø—Ä–æ–¥–∞–∂.
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (family, city, state) –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –≤—ã—Å–æ–∫—É—é –∑–Ω–∞—á–∏–º–æ—Å—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ state ‚Äî –±—É–¥–µ–º –≤–∫–ª—é—á–∞—Ç—å –µ–≥–æ –∫–∞–∫ –≥—Ä–∞–Ω–∏—á–Ω—ã–π –ø–æ—Ä–æ–≥.
- –î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤—ã—à–µ state –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ.

**‚úÖ –í—ã–≤–æ–¥—ã –ø–æ –∏—Ç–æ–≥–∞–º –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è**

- –ú–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ —Å –æ–¥–Ω–∏–º —Å–∫—Ä—ã—Ç—ã–º —Å–ª–æ–µ–º –ø–æ–∫–∞–∑–∞–ª–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ –º–µ—Ä–µ –æ–±—É—á–µ–Ω–∏—è.
- –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ RMSE = 875.17, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–µ–º–ª–µ–º—ã–º —É—Ä–æ–≤–Ω–µ–º –¥–ª—è –∑–∞–¥–∞—á —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º –ø—Ä–æ–¥–∞–∂ –≤ —à—Ç—É–∫–∞—Ö (–ø—Ä–∏ —É—á—ë—Ç–µ –º–∞—Å—à—Ç–∞–±–∞ –¥–∞–Ω–Ω—ã—Ö).
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–ª–∞–±–æ –≤–ª–∏—è—é—â–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (oil_zone, earthquake, salary, –∏ –¥—Ä.) –ø–æ–∑–≤–æ–ª–∏–ª–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –º–æ–¥–µ–ª—å –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞.
- –ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–æ–±—É—á–µ–Ω–∞ –Ω–∞ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ —Ç–µ—Å—Ç–µ.
- –§–∏–Ω–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è–º–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ submission_12-02-2024.csv.

## üìä –ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ

<br>
   <div class="case-image">
      <img src="{{ site.baseurl }}/assets/images/case8_12.png" alt="–∫–µ–π—Å—ã –ø–æ Power BI" class="img-fluid w-75">
    </div>

